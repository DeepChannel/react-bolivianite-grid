{"version":3,"sources":["resizer.tsx"],"names":[],"mappings":"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","file":"resizer.js","sourcesContent":["import * as React from 'react';\r\nimport { IHeader, HeaderType } from './types';\r\nimport HeaderRepository from './header-repository';\r\nimport Grid from './grid';\r\nimport Context from './context';\r\n\r\nexport interface IResizerProps {\r\n    header: IHeader;\r\n}\r\n\r\nexport class Resizer extends React.PureComponent<IResizerProps, any> {\r\n    private static _r: React.CSSProperties = {\r\n        position: 'absolute',\r\n        right: 0,\r\n        top: 0,\r\n        bottom: 0,\r\n        width: 6,\r\n        cursor: 'col-resize'\r\n    };\r\n\r\n    private static _b: React.CSSProperties = {\r\n        position: 'absolute',\r\n        right: 0,\r\n        height: 6,\r\n        bottom: 0,\r\n        left: 0,\r\n        cursor: 'row-resize'\r\n    };\r\n\r\n    private _moving: {\r\n        start: number;\r\n        type: 'left-level' | 'top-level' | 'row' | 'column';\r\n    } = null;\r\n\r\n    private _lastClick: {\r\n        type: 'left-level' | 'top-level' | 'row' | 'column';\r\n        time: number;\r\n    };\r\n\r\n    private _moveListener: any = null;\r\n    private _upListener: any = null;\r\n    private _escListener: any = null;\r\n    private _moved = false;\r\n    private _grid: Grid;\r\n    private _repository: HeaderRepository;\r\n\r\n    private _unbind() {\r\n        if (this._moving) {\r\n            this._grid.previewResizeHeader(null);\r\n            this._grid.previewResizeLevel(null);\r\n        }\r\n\r\n        if (this._moveListener) {\r\n            document.body.removeEventListener('mousemove', this._moveListener);\r\n            this._moveListener = null;\r\n        }\r\n\r\n        if (this._upListener) {\r\n            window.removeEventListener('mouseup', this._upListener);\r\n            this._upListener = null;\r\n        }\r\n\r\n        if (this._escListener) {\r\n            window.removeEventListener('keydown', this._escListener);\r\n            this._escListener = null;\r\n        }\r\n\r\n        this._moving = null;\r\n    }\r\n\r\n    private _onMove(change: number) {\r\n        if (!this._moving) {\r\n            return;\r\n        }\r\n\r\n        let { type } = this._moving;\r\n        let { header } = this.props;\r\n\r\n        switch (type) {\r\n            case 'column':\r\n            case 'row':\r\n                this._grid.previewResizeHeader({\r\n                    header: header,\r\n                    change: change,\r\n                });\r\n                break;\r\n\r\n            case 'left-level':\r\n            case 'top-level':\r\n                this._grid.previewResizeLevel({\r\n                    header: header,\r\n                    change: change,\r\n                });\r\n                break;\r\n        }\r\n    }\r\n\r\n    private _onChange(change: number) {\r\n        if (!this._moving || !this._moved) {\r\n            return;\r\n        }\r\n\r\n        let { type } = this._moving;\r\n        let { header } = this.props;\r\n\r\n        switch (type) {\r\n            case 'column':\r\n            case 'row':\r\n                this._grid.resizeHeaders({\r\n                    behavior: 'manual',\r\n                    headers: [{\r\n                        type: type === 'row' ? HeaderType.Row : HeaderType.Column,\r\n                        header: header,\r\n                        size: this._repository.getSize(header) + change\r\n                    }]\r\n                });\r\n                break;\r\n\r\n            case 'left-level':\r\n            case 'top-level':\r\n                let start = (\r\n                    type === 'left-level'\r\n                        ? this._repository.getLeftLevelWidth(this._repository.getPositionLevel(header))\r\n                        : this._repository.getTopLevelHeight(this._repository.getPositionLevel(header))\r\n                );\r\n                this._grid.resizeHeaders({\r\n                    behavior: 'manual',\r\n                    levels: [{\r\n                        type: type === 'left-level' ? HeaderType.Row : HeaderType.Column,\r\n                        level: this._repository.getPositionLevel(header),\r\n                        size: start + change\r\n                    }]\r\n                });\r\n                break;\r\n        }\r\n    }\r\n\r\n    private _onMouseDown = (e: React.MouseEvent<HTMLDivElement>) => {\r\n        this._moved = false;\r\n\r\n        e.preventDefault();\r\n\r\n        if (e.button !== 0) {\r\n            return;\r\n        }\r\n\r\n        let type = e.currentTarget.getAttribute('x-type') as ('r' | 'b');\r\n        let p = type === 'r' ? e.pageX : e.pageY;\r\n        let headerType = this._repository.getHeaderType(this.props.header);\r\n        let isRow = headerType === HeaderType.Row;\r\n\r\n        this._unbind();\r\n\r\n        let now = Date.now();\r\n        let movingType = (\r\n            type === 'r'\r\n                ? isRow\r\n                    ? 'left-level'\r\n                    : 'column'\r\n                : isRow\r\n                    ? 'row'\r\n                    : 'top-level'\r\n        );\r\n\r\n        if (this._lastClick && this._lastClick.type === movingType && (now - this._lastClick.time < 500)) {\r\n            this._grid.previewResizeHeader(null);\r\n            this._grid.previewResizeLevel(null);\r\n            this._unbind();\r\n\r\n            const workType = movingType === 'column' || movingType === 'row' ? 'cells' : 'levels';\r\n            this._grid.autoMeasure([this.props.header], workType);\r\n            return;\r\n        }\r\n\r\n        this._moving = {\r\n            type: movingType as any,\r\n            start: p\r\n        };\r\n\r\n        this._lastClick = {\r\n            type: movingType as any,\r\n            time: now\r\n        };\r\n\r\n        let change = 0;\r\n\r\n        window.addEventListener('mouseup', this._upListener = () => {\r\n            this._onChange(change);\r\n\r\n            this._moved = false;\r\n\r\n            this._grid.previewResizeHeader(null);\r\n            this._grid.previewResizeLevel(null);\r\n            this._unbind();\r\n        });\r\n\r\n        window.addEventListener('keydown', this._escListener = (ev: KeyboardEvent) => {\r\n            if (ev.keyCode === 27) { // esc\r\n                this._unbind();\r\n            }\r\n        });\r\n\r\n        document.body.addEventListener('mousemove', this._moveListener = (ev: MouseEvent) => {\r\n            if (!this._moving) {\r\n                return;\r\n            }\r\n\r\n            this._moved = true;\r\n\r\n            let m = type === 'r' ? ev.pageX : ev.pageY;\r\n            change = m - this._moving.start;\r\n            this._onMove(change);\r\n        });\r\n    }\r\n\r\n    public componentWillUnmount() {\r\n        this._unbind();\r\n    }\r\n\r\n    public render() {\r\n        return (\r\n            <Context.Consumer>\r\n                {({ grid, repository }) => {\r\n                    this._grid = grid;\r\n                    this._repository = repository;\r\n\r\n                    return (\r\n                        <>\r\n                            <div\r\n                                x-type=\"r\"\r\n                                style={Resizer._r}\r\n                                onMouseDown={this._onMouseDown}\r\n                            />\r\n                            <div\r\n                                x-type=\"b\"\r\n                                style={Resizer._b}\r\n                                onMouseDown={this._onMouseDown}\r\n                            />\r\n                        </>\r\n                    );\r\n                }}\r\n            </Context.Consumer>\r\n        );\r\n    }\r\n}\r\n\r\nexport default Resizer;\r\n"]}